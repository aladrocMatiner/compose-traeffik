# File: .env.example
#
# Environment variables for the Docker Compose stack.
# Copy this file to .env and adjust values as needed.
#
# --- General Configuration ---

# Project name used to derive the default base domain.
# The default convention is <PROJECT_NAME>.aladroc.io
PROJECT_NAME=compose-traeffik

# Domain name for local development.
# Used by whoami service, Traefik dashboard, and certificate generation.
# IMPORTANT: You must add an entry to your /etc/hosts file (or equivalent)
# mapping this domain to 127.0.0.1 for local resolution.
# Example: 127.0.0.1 whoami.<BASE_DOMAIN> traefik.<BASE_DOMAIN> step-ca.<BASE_DOMAIN>
DEV_DOMAIN=compose-traeffik.aladroc.io

# Base domain for loopback subdomain mappings.
# Default convention: <PROJECT_NAME>.aladroc.io
# Keep this aligned with DEV_DOMAIN unless you intentionally separate them.
BASE_DOMAIN=compose-traeffik.aladroc.io

# Loopback X octet for 127.0.X.Y assignments (0-255).
LOOPBACK_X=10

# Optional comma-separated list of endpoints (order preserved).
# Example: whoami,traefik,stepca
ENDPOINTS=whoami,traefik,stepca

# Optional overrides for hosts-subdomains.sh.
# HOSTS_FILE defaults to /etc/hosts
# ENV_FILE defaults to .env (if present) or .env.example
HOSTS_FILE=
ENV_FILE=

# --- DNS Service (Technitium) Configuration ---

# Bind address for DNS port 53 (tcp/udp). Default is localhost-only.
DNS_BIND_ADDRESS=127.0.0.1

# Hostname prefix for the DNS UI.
DNS_UI_HOSTNAME=dns

# Admin password for the Technitium DNS web console.
# Set this to a strong value before running dns-provision.
DNS_ADMIN_PASSWORD=change-me

# Path to the htpasswd file used by Traefik BasicAuth for the DNS UI.
DNS_UI_BASIC_AUTH_HTPASSWD_PATH=./traefik/auth/dns-ui.htpasswd

# Middlewares applied to the DNS UI router (add dns-ui-allowlist@docker to enable allowlist).
DNS_UI_MIDDLEWARES=security-headers@file,dns-ui-auth@file

# Optional allowlist for the DNS UI (used when dns-ui-allowlist@docker is included).
DNS_UI_ALLOWLIST_SOURCE_RANGES=127.0.0.1/32,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16

# Traefik Docker image to use. Prefer a stable major version.
# Example: traefik:v3.0
TRAEFIK_IMAGE=traefik:v3.6.7

# Enable/Disable Traefik Dashboard. Default is false (disabled).
# If enabled, it will be available at https://traefik.<DEV_DOMAIN>
# WARNING: Do not expose publicly without proper authentication.
TRAEFIK_DASHBOARD=false

# Enable/Disable automatic HTTP to HTTPS redirection. Default is true.
# If true, all HTTP requests to configured entrypoints will be redirected to HTTPS.
HTTP_TO_HTTPS_REDIRECT=true

# --- TLS Mode A (Local Self-Signed) Configuration ---

# No specific environment variables required here, configured directly via volume mounts.

# --- TLS Mode B (Let's Encrypt with Certbot) Configuration ---

# Email for Let's Encrypt notifications (required for certbot issuance).
# Used by Traefik's ACME resolver when 'le' profile is active.
ACME_EMAIL=you@example.com

# Use Let's Encrypt staging environment (true/false).
# Set to 'true' for testing to avoid hitting rate limits on production.
# Set to 'false' only when you are ready to get production certificates.
LETSENCRYPT_STAGING=true

# ACME directory URL for Let's Encrypt (used by Traefik's ACME client).
# Use staging for testing to avoid rate limits.
# Production: https://acme-v02.api.letsencrypt.org/directory
# Staging: https://acme-staging-v02.api.letsencrypt.org/directory
LETSENCRYPT_CA_SERVER=https://acme-staging-v02.api.letsencrypt.org/directory

# --- TLS Mode C (Step-CA) Configuration ---

# Name for your Step-CA instance.
STEP_CA_NAME="Local Dev CA"

# Passwords for Step-CA (for initial bootstrap only).
# In a real environment, these would be handled via secrets management.
# For local dev, a placeholder is acceptable during bootstrap.
# IMPORTANT: These are used *only* during the `stepca-bootstrap` command.
#            They are NOT used by the running step-ca service directly.
STEP_CA_ADMIN_PROVISIONER_PASSWORD="adminpassword" # Password for the admin provisioner
STEP_CA_PASSWORD="capassword"                     # Password to encrypt the CA private key

# --- Internal Configuration (usually leave as-is) ---

# This variable is dynamically set by the Makefile based on the active profile.
# It tells Traefik which certificate resolver to use for ACME challenges.
# For Mode A (default), it's empty, relying on file-based TLS config.
# For Mode B (LE), it becomes 'le-resolver'.
# For Mode C (step-ca), it becomes 'stepca-resolver'.
TLS_CERT_RESOLVER=

# The COMPOSE_PROFILES environment variable is used by Docker Compose to activate
# specific services. It should be set when running `make up` or `make <profile>-up`.
# Example: COMPOSE_PROFILES=le
# Example: COMPOSE_PROFILES=stepca
# Example: COMPOSE_PROFILES=le,stepca (for combining profiles, though not typically needed for cert modes)
COMPOSE_PROFILES=
