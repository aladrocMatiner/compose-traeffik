# File: .env.example
#
# Environment variables for the Docker Compose stack.
# Copy this file to .env and adjust values as needed.
#
# --- General Configuration ---

# Project name used to derive the default base domain.
# The default convention is <PROJECT_NAME>.aladroc.io
PROJECT_NAME=compose-traeffik

# Optional override for docker compose project name.
# Defaults to PROJECT_NAME; if empty, the repo directory name is used.
COMPOSE_PROJECT_NAME=

# Domain name for local development.
# Used by whoami service, Traefik dashboard, and certificate generation.
# IMPORTANT: You must add an entry to your /etc/hosts file (or equivalent)
# mapping this domain to 127.0.0.1 for local resolution.
# Example: 127.0.0.1 whoami.<BASE_DOMAIN> traefik.<BASE_DOMAIN> step-ca.<BASE_DOMAIN>
# Default uses a local-only domain.
DEV_DOMAIN=local.test

# Base domain for loopback subdomain mappings.
# Default uses a local-only domain.
# Keep this aligned with DEV_DOMAIN unless you intentionally separate them.
BASE_DOMAIN=local.test

# Loopback X octet for 127.0.X.Y assignments (0-255).
LOOPBACK_X=10

# Optional comma-separated list of endpoints (order preserved).
# Example: whoami,traefik,stepca
ENDPOINTS=whoami,traefik,stepca

# Optional overrides for hosts-subdomains.sh.
# HOSTS_FILE defaults to /etc/hosts
# ENV_FILE defaults to .env (if present) or .env.example
HOSTS_FILE=
ENV_FILE=

# --- DNS Service (Technitium) Configuration ---

# Bind address for DNS port 53 (tcp/udp). Default is localhost-only.
DNS_BIND_ADDRESS=127.0.0.1

# Hostname prefix for the DNS UI.
DNS_UI_HOSTNAME=dns

# Admin password for the Technitium DNS web console.
# Leave blank to auto-generate via `make bootstrap`.
DNS_ADMIN_PASSWORD=

# Path to the htpasswd file used by Traefik BasicAuth for the DNS UI (container path).
# Replace the example file with a real htpasswd before enabling the dns profile.
# The preflight check rejects .example paths when dns is enabled.
DNS_UI_BASIC_AUTH_HTPASSWD_PATH=/etc/traefik/auth/dns-ui.htpasswd.example

# Path to the htpasswd file used by Traefik BasicAuth for the dashboard (container path).
# Replace the example file with a real htpasswd before enabling the dashboard.
# The preflight check rejects .example paths when the dashboard is enabled.
TRAEFIK_DASHBOARD_BASIC_AUTH_HTPASSWD_PATH=/etc/traefik/auth/traefik-dashboard.htpasswd.example

# Middlewares applied to the DNS UI router (add dns-ui-allowlist@docker to enable allowlist).
DNS_UI_MIDDLEWARES=security-headers@file,dns-ui-auth@file

# Optional allowlist for the DNS UI (used when dns-ui-allowlist@docker is included).
DNS_UI_ALLOWLIST_SOURCE_RANGES=127.0.0.1/32,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16

# Traefik Docker image to use. Prefer a stable major version.
# Example: traefik:v3.0
TRAEFIK_IMAGE=traefik:v3.6.7

# Enable/Disable Traefik Dashboard. Default is false (disabled).
# If enabled, it will be available at https://traefik.<DEV_DOMAIN>
# WARNING: Do not expose publicly without proper authentication.
TRAEFIK_DASHBOARD=false

# Enable/Disable automatic HTTP to HTTPS redirection (tests).
# If true, tests expect HTTP to redirect to HTTPS.
HTTP_TO_HTTPS_REDIRECT=true
# Middleware used for HTTP routers. Use redirect-to-https@file or noop@file.
HTTP_TO_HTTPS_MIDDLEWARE=redirect-to-https@file

# --- TLS Mode A (Local Self-Signed) Configuration ---

# No specific environment variables required here, configured directly via volume mounts.

# --- TLS Mode B (Let's Encrypt with Certbot) Configuration ---

# Email for Let's Encrypt notifications (required for certbot issuance).
# Used by Traefik's ACME resolver when 'le' profile is active.
ACME_EMAIL=you@example.com

# Use Let's Encrypt staging environment (true/false).
# Set to 'true' for testing to avoid hitting rate limits on production.
# Set to 'false' only when you are ready to get production certificates.
LETSENCRYPT_STAGING=true

# ACME directory URL for Let's Encrypt (used by Traefik's ACME client and certbot).
# Use staging for testing to avoid rate limits.
# Production: https://acme-v02.api.letsencrypt.org/directory
# Staging: https://acme-staging-v02.api.letsencrypt.org/directory
LETSENCRYPT_CA_SERVER=https://acme-staging-v02.api.letsencrypt.org/directory

# Optional comma-separated domain list for Certbot issuance (uses -d args).
# If empty, defaults to: DEV_DOMAIN, whoami.<DEV_DOMAIN>, traefik.<DEV_DOMAIN>, step-ca.<DEV_DOMAIN>
CERTBOT_DOMAINS=

# --- TLS Mode C (Step-CA) Configuration ---

# Name for your Step-CA instance.
STEP_CA_NAME="Local Dev CA"

# DNS names/IPs for Step-CA certificates (bootstrap only).
# This is used by scripts/stepca-bootstrap.sh to set SANs.
STEP_CA_DNS=step-ca,localhost,127.0.0.1,step-ca.${DEV_DOMAIN}

# Enable SSH CA support during bootstrap (not needed for ACME).
STEP_CA_ENABLE_SSH=false

# ACME directory URL for Step-CA (used by Traefik's ACME resolver in Mode C).
STEP_CA_CA_SERVER=https://step-ca.${DEV_DOMAIN}:9000/acme/acme/directory

# Passwords for Step-CA (for initial bootstrap only).
# Leave blank to auto-generate via `make bootstrap`.
# IMPORTANT: These are used *only* during the `stepca-bootstrap` command.
#            They are NOT used by the running step-ca service directly.
# Password for the admin provisioner.
STEP_CA_ADMIN_PROVISIONER_PASSWORD=
# Password to encrypt the CA private key.
STEP_CA_PASSWORD=

# --- Internal Configuration (usually leave as-is) ---

# This variable is dynamically set by the Makefile based on the active profile.
# It tells Traefik which certificate resolver to use for ACME challenges.
# For Mode A (default), it's empty, relying on file-based TLS config.
# For Mode B (LE), it becomes 'le-resolver'.
# For Mode C (step-ca), it becomes 'stepca-resolver'.
TLS_CERT_RESOLVER=

# The COMPOSE_PROFILES environment variable is used by Docker Compose to activate
# specific services. It should be set when running `make up` or `make <profile>-up`.
# Example: COMPOSE_PROFILES=le
# Example: COMPOSE_PROFILES=stepca
# Example: COMPOSE_PROFILES=le,stepca (for combining profiles, though not typically needed for cert modes)
COMPOSE_PROFILES=
