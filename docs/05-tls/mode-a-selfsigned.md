# Mode A: Local Self-Signed CA + Certificates

## Purpose / When to Use

Use Mode A for local development when you want HTTPS without external certificate issuance. Traefik serves local self-signed certificates generated by the repo scripts.

## Prerequisites

- Docker and Docker Compose
- `make`
- `openssl`
- A configured `.env` file

## Steps

1. **Copy the example environment file (if needed):**
   ```bash
   cp .env.example .env
   ```

2. **Set domain values in `.env`:**
   - `DEV_DOMAIN`
   - `BASE_DOMAIN`
   - `LOOPBACK_X`
   - `ENDPOINTS`

3. **Generate local self-signed certificates:**
   ```bash
   make certs-local
   ```

4. **Map local subdomains to loopback:**
   ```bash
   sudo make hosts-apply
   ```

5. **Start the stack:**
   ```bash
   make up
   ```

6. **Run smoke tests:**
   ```bash
   make test
   ```

## Expected Result

- Traefik serves HTTPS using locally generated certificates.
- `whoami.$DEV_DOMAIN` routes correctly through Traefik.
- TLS handshake tests pass.

## Verification Commands

```bash
curl -vk "https://whoami.$DEV_DOMAIN/"
openssl s_client -connect "whoami.$DEV_DOMAIN:443" -servername "whoami.$DEV_DOMAIN" -CAfile shared/certs/local-ca/ca.crt -verify_return_error -prexit
```

## Common Pitfalls

- **Browser shows certificate warning:**
  - Cause: The local CA is not trusted by your OS/browser.
  - Fix: Trust `shared/certs/local-ca/ca.crt` in your OS trust store.

- **Hostnames do not resolve:**
  - Cause: `/etc/hosts` missing entries for `$DEV_DOMAIN` subdomains.
  - Fix: Run `sudo make hosts-apply`.

## Links to Related Docs

- [Documentation Index](../README.md)
- [Repo Facts](../90-facts.md)
- [Glossary](../99-glossary.md)
